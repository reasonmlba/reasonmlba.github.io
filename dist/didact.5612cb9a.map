{"version":3,"sources":["didact.js"],"names":["Didact","importFromBelow","Counter","props","state","value","setState","createElement","onClick","increment","bind","decrement","Component","App","render","document","getElementById","TEXT_ELEMENT","type","config","Object","assign","args","hasChildren","length","rawChildren","concat","children","filter","c","map","createTextElement","nodeValue","isEvent","name","startsWith","isAttribute","isNew","prev","next","key","isGone","updateDomProperties","dom","prevProps","nextProps","keys","forEach","eventType","toLowerCase","substring","removeEventListener","style","addEventListener","createDomElement","fiber","isTextElement","createTextNode","partialState","scheduleUpdate","createInstance","instance","__fiber","HOST_COMPONENT","CLASS_COMPONENT","HOST_ROOT","PLACEMENT","DELETION","UPDATE","ENOUGH_TIME","updateQueue","nextUnitOfWork","pendingCommit","elements","containerDom","push","from","newProps","requestIdleCallback","performWork","deadline","workLoop","console","log","group","resetNextUnitOfWork","groupCollapsed","tag","performUnitOfWork","groupEnd","commitAllWork","update","shift","root","_rootContainerFiber","getRoot","stateNode","alternate","node","parent","wipFiber","beginWork","child","uow","completeWork","sibling","updateClassComponent","updateHostComponent","newChildElements","reconcileChildrenArray","cloneChildFibers","arrify","val","Array","isArray","index","oldFiber","newFiber","prevFiber","element","sameType","effectTag","effects","parentFiber","oldChild","prevChild","newChild","childEffects","thisEffect","parentEffects","commitWork","f","domParentFiber","domParent","appendChild","commitDeletion","removeChild"],"mappings":"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","file":"didact.5612cb9a.map","sourceRoot":"../src","sourcesContent":["const Didact = importFromBelow();\n\nclass Counter extends Didact.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      value: 0\n    };\n  }\n  increment() {\n    this.setState({ value: this.state.value + 1 });\n  }\n\n  decrement() {\n    this.setState({ value: this.state.value - 1 });\n  }\n  render() {\n    return Didact.createElement(\n      \"div\",\n      {},\n      Didact.createElement(\n        \"button\",\n        { onClick: this.increment.bind(this) },\n        \"+\"\n      ),\n      Didact.createElement(\"h2\", {}, \"Counter \" + this.state.value),\n      Didact.createElement(\n        \"button\",\n        { onClick: this.decrement.bind(this) },\n        \"-\"\n      )\n    );\n  }\n}\n\nclass App extends Didact.Component {\n  render() {\n    return Didact.createElement(\"div\", {}, Didact.createElement(Counter, {}));\n  }\n}\nDidact.render(Didact.createElement(App, {}), document.getElementById(\"didact\"));\n\nfunction importFromBelow() {\n  //#region element.js\n  const TEXT_ELEMENT = \"TEXT ELEMENT\";\n\n  function createElement(type, config, ...args) {\n    const props = Object.assign({}, config);\n    const hasChildren = args.length > 0;\n    const rawChildren = hasChildren ? [].concat(...args) : [];\n    props.children = rawChildren\n      .filter(c => c != null && c !== false)\n      .map(c => (c instanceof Object ? c : createTextElement(c)));\n    return { type, props };\n  }\n\n  function createTextElement(value) {\n    return createElement(TEXT_ELEMENT, { nodeValue: value });\n  }\n  //#endregion\n  //#region dom-utils.js\n  const isEvent = name => name.startsWith(\"on\");\n  const isAttribute = name =>\n    !isEvent(name) && name != \"children\" && name != \"style\";\n  const isNew = (prev, next) => key => prev[key] !== next[key];\n  const isGone = (prev, next) => key => !(key in next);\n\n  function updateDomProperties(dom, prevProps, nextProps) {\n    // Remove event listeners\n    Object.keys(prevProps)\n      .filter(isEvent)\n      .filter(key => !(key in nextProps) || isNew(prevProps, nextProps)(key))\n      .forEach(name => {\n        const eventType = name.toLowerCase().substring(2);\n        dom.removeEventListener(eventType, prevProps[name]);\n      });\n\n    // Remove attributes\n    Object.keys(prevProps)\n      .filter(isAttribute)\n      .filter(isGone(prevProps, nextProps))\n      .forEach(name => {\n        dom[name] = null;\n      });\n\n    // Set attributes\n    Object.keys(nextProps)\n      .filter(isAttribute)\n      .filter(isNew(prevProps, nextProps))\n      .forEach(name => {\n        dom[name] = nextProps[name];\n      });\n\n    // Set style\n    prevProps.style = prevProps.style || {};\n    nextProps.style = nextProps.style || {};\n    Object.keys(nextProps.style)\n      .filter(isNew(prevProps.style, nextProps.style))\n      .forEach(key => {\n        dom.style[key] = nextProps.style[key];\n      });\n    Object.keys(prevProps.style)\n      .filter(isGone(prevProps.style, nextProps.style))\n      .forEach(key => {\n        dom.style[key] = \"\";\n      });\n\n    // Add event listeners\n    Object.keys(nextProps)\n      .filter(isEvent)\n      .filter(isNew(prevProps, nextProps))\n      .forEach(name => {\n        const eventType = name.toLowerCase().substring(2);\n        dom.addEventListener(eventType, nextProps[name]);\n      });\n  }\n\n  function createDomElement(fiber) {\n    const isTextElement = fiber.type === TEXT_ELEMENT;\n    const dom = isTextElement\n      ? document.createTextNode(\"\")\n      : document.createElement(fiber.type);\n    updateDomProperties(dom, [], fiber.props);\n    return dom;\n  }\n  //#endregion\n  //#region component.js\n  class Component {\n    constructor(props) {\n      this.props = props || {};\n      this.state = this.state || {};\n    }\n\n    setState(partialState) {\n      scheduleUpdate(this, partialState);\n    }\n  }\n\n  function createInstance(fiber) {\n    const instance = new fiber.type(fiber.props);\n    instance.__fiber = fiber;\n    return instance;\n  }\n  //#endregion\n  //#region reconciler.js\n  // Fiber tags\n  const HOST_COMPONENT = \"host\";\n  const CLASS_COMPONENT = \"class\";\n  const HOST_ROOT = \"root\";\n\n  // Effect tags\n  const PLACEMENT = \"PLACEMENT\";\n  const DELETION = \"DELETION\";\n  const UPDATE = \"UPDATE\";\n\n  const ENOUGH_TIME = 1;\n\n  // Global state\n  const updateQueue = [];\n  let nextUnitOfWork = null;\n  let pendingCommit = null;\n\n  function render(elements, containerDom) {\n    updateQueue.push({\n      from: HOST_ROOT,\n      dom: containerDom,\n      newProps: { children: elements }\n    });\n    requestIdleCallback(performWork);\n  }\n\n  function scheduleUpdate(instance, partialState) {\n    updateQueue.push({\n      from: CLASS_COMPONENT,\n      instance: instance,\n      partialState: partialState\n    });\n    requestIdleCallback(performWork);\n  }\n\n  function performWork(deadline) {\n    workLoop(deadline);\n    if (nextUnitOfWork || updateQueue.length > 0) {\n      console.log(\"New work to do after work loop\");\n      requestIdleCallback(performWork);\n    }\n  }\n\n  function workLoop(deadline) {\n    console.group(\"Perfoming work\");\n    if (!nextUnitOfWork) {\n      resetNextUnitOfWork();\n    }\n    while (nextUnitOfWork) {\n      console.groupCollapsed(\"Next unit of work \" + nextUnitOfWork.tag);\n      nextUnitOfWork = performUnitOfWork(nextUnitOfWork);\n      console.groupEnd();\n    }\n    if (pendingCommit) {\n      console.groupCollapsed(\"Commit all work on \" + pendingCommit.tag);\n      commitAllWork(pendingCommit);\n      console.groupEnd();\n    }\n    console.groupEnd();\n  }\n\n  function resetNextUnitOfWork() {\n    const update = updateQueue.shift();\n    if (!update) {\n      return;\n    }\n\n    // Copy the setState parameter from the update payload to the corresponding fiber\n    if (update.partialState) {\n      update.instance.__fiber.partialState = update.partialState;\n    }\n\n    const root =\n      update.from == HOST_ROOT\n        ? update.dom._rootContainerFiber\n        : getRoot(update.instance.__fiber);\n\n    nextUnitOfWork = {\n      tag: HOST_ROOT,\n      stateNode: update.dom || root.stateNode,\n      props: update.newProps || root.props,\n      alternate: root\n    };\n  }\n\n  function getRoot(fiber) {\n    console.groupCollapsed(\"Getting to root\");\n    let node = fiber;\n    while (node.parent) {\n      console.log(node);\n      node = node.parent;\n    }\n    console.log(node);\n    console.groupEnd();\n    return node;\n  }\n\n  function performUnitOfWork(wipFiber) {\n    console.groupCollapsed(\"Perfoming unit of work \" + wipFiber.tag);\n    beginWork(wipFiber);\n    if (wipFiber.child) {\n      console.log(\"It has child, returning his child\");\n      console.groupEnd();\n      return wipFiber.child;\n    }\n\n    console.log(\"It does not have a child, looking for sibiling\");\n    // No child, we call completeWork until we find a sibling\n    let uow = wipFiber;\n    while (uow) {\n      completeWork(uow);\n      if (uow.sibling) {\n        // Sibling needs to beginWork\n        console.log(\"Sibling found, returning to perfom unit of work on him\");\n        console.groupEnd();\n        return uow.sibling;\n      }\n      uow = uow.parent;\n    }\n\n    return null;\n  }\n\n  function beginWork(wipFiber) {\n    if (wipFiber.tag == CLASS_COMPONENT) {\n      updateClassComponent(wipFiber);\n    } else {\n      updateHostComponent(wipFiber);\n    }\n  }\n\n  function updateHostComponent(wipFiber) {\n    if (!wipFiber.stateNode) {\n      wipFiber.stateNode = createDomElement(wipFiber);\n    }\n\n    const newChildElements = wipFiber.props.children;\n    reconcileChildrenArray(wipFiber, newChildElements);\n  }\n\n  function updateClassComponent(wipFiber) {\n    let instance = wipFiber.stateNode;\n    if (instance == null) {\n      // Call class constructor\n      instance = wipFiber.stateNode = createInstance(wipFiber);\n    } else if (wipFiber.props == instance.props && !wipFiber.partialState) {\n      // No need to render, clone children from last time\n      console.log(\"Cloning fibers\");\n      cloneChildFibers(wipFiber);\n      return;\n    }\n\n    instance.props = wipFiber.props;\n    instance.state = Object.assign({}, instance.state, wipFiber.partialState);\n    wipFiber.partialState = null;\n\n    const newChildElements = wipFiber.stateNode.render();\n    reconcileChildrenArray(wipFiber, newChildElements);\n  }\n\n  function arrify(val) {\n    return val == null ? [] : Array.isArray(val) ? val : [val];\n  }\n\n  function reconcileChildrenArray(wipFiber, newChildElements) {\n    console.groupCollapsed(\"Reconcile children of \", wipFiber.tag);\n    const elements = arrify(newChildElements);\n\n    let index = 0;\n    let oldFiber = wipFiber.alternate ? wipFiber.alternate.child : null;\n    let newFiber = null;\n    while (index < elements.length || oldFiber != null) {\n      const prevFiber = newFiber;\n      const element = index < elements.length && elements[index];\n      const sameType = oldFiber && element && element.type == oldFiber.type;\n\n      if (sameType) {\n        newFiber = {\n          type: oldFiber.type,\n          tag: oldFiber.tag,\n          stateNode: oldFiber.stateNode,\n          props: element.props,\n          parent: wipFiber,\n          alternate: oldFiber,\n          partialState: oldFiber.partialState,\n          effectTag: UPDATE\n        };\n      }\n\n      if (element && !sameType) {\n        newFiber = {\n          type: element.type,\n          tag:\n            typeof element.type === \"string\" ? HOST_COMPONENT : CLASS_COMPONENT,\n          props: element.props,\n          parent: wipFiber,\n          effectTag: PLACEMENT\n        };\n      }\n\n      if (oldFiber && !sameType) {\n        oldFiber.effectTag = DELETION;\n        wipFiber.effects = wipFiber.effects || [];\n        wipFiber.effects.push(oldFiber);\n      }\n\n      if (oldFiber) {\n        oldFiber = oldFiber.sibling;\n      }\n\n      if (index == 0) {\n        wipFiber.child = newFiber;\n      } else if (prevFiber && element) {\n        prevFiber.sibling = newFiber;\n      }\n      console.log(newFiber);\n\n      index++;\n    }\n    console.groupEnd();\n  }\n\n  function cloneChildFibers(parentFiber) {\n    const oldFiber = parentFiber.alternate;\n    if (!oldFiber.child) {\n      return;\n    }\n\n    let oldChild = oldFiber.child;\n    let prevChild = null;\n    while (oldChild) {\n      const newChild = {\n        type: oldChild.type,\n        tag: oldChild.tag,\n        stateNode: oldChild.stateNode,\n        props: oldChild.props,\n        partialState: oldChild.partialState,\n        alternate: oldChild,\n        parent: parentFiber\n      };\n      if (prevChild) {\n        prevChild.sibling = newChild;\n      } else {\n        parentFiber.child = newChild;\n      }\n      prevChild = newChild;\n      oldChild = oldChild.sibling;\n    }\n  }\n\n  function completeWork(fiber) {\n    console.groupCollapsed(\"Completing work on \" + fiber.tag);\n    if (fiber.tag == CLASS_COMPONENT) {\n      fiber.stateNode.__fiber = fiber;\n    }\n\n    if (fiber.parent) {\n      console.log(\"Fiber has a parent, passing effects to it's parent\");\n      const childEffects = fiber.effects || [];\n      const thisEffect = fiber.effectTag != null ? [fiber] : [];\n      const parentEffects = fiber.parent.effects || [];\n      fiber.parent.effects = parentEffects.concat(childEffects, thisEffect);\n      console.groupCollapsed(\"Effects\");\n      fiber.parent.effects.forEach(console.log);\n      console.groupEnd();\n    } else {\n      console.log(\"Fiber is root, ready to commit\");\n      pendingCommit = fiber;\n    }\n    console.groupEnd();\n  }\n\n  function commitAllWork(fiber) {\n    fiber.effects.forEach(f => {\n      commitWork(f);\n    });\n    fiber.stateNode._rootContainerFiber = fiber;\n    nextUnitOfWork = null;\n    pendingCommit = null;\n  }\n\n  function commitWork(fiber) {\n    if (fiber.tag == HOST_ROOT) {\n      return;\n    }\n\n    let domParentFiber = fiber.parent;\n    while (domParentFiber.tag == CLASS_COMPONENT) {\n      domParentFiber = domParentFiber.parent;\n    }\n    const domParent = domParentFiber.stateNode;\n\n    if (fiber.effectTag == PLACEMENT && fiber.tag == HOST_COMPONENT) {\n      domParent.appendChild(fiber.stateNode);\n    } else if (fiber.effectTag == UPDATE) {\n      updateDomProperties(fiber.stateNode, fiber.alternate.props, fiber.props);\n    } else if (fiber.effectTag == DELETION) {\n      commitDeletion(fiber, domParent);\n    }\n  }\n\n  function commitDeletion(fiber, domParent) {\n    let node = fiber;\n    while (true) {\n      if (node.tag == CLASS_COMPONENT) {\n        node = node.child;\n        continue;\n      }\n      domParent.removeChild(node.stateNode);\n      while (node != fiber && !node.sibling) {\n        node = node.parent;\n      }\n      if (node == fiber) {\n        return;\n      }\n      node = node.sibling;\n    }\n  }\n  //#endregion\n  return {\n    createElement,\n    render,\n    Component\n  };\n}\n"]}